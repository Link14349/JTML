{"version":3,"sources":["../src/index.js"],"names":["JTML","global","globalThis","DOMAIN","$","compileNow","compiler","$compiler","fun","name","hide","set","tag","tags","children","tokenName","value","gotName","gotValue","i","length","localName","text","tokens","split","tmp","eval","show","console","log","v","each","cb","compile","domain","tagJq","css","document","ready"],"mappings":"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","file":"index.js","sourcesContent":["const JTML = {};\nconst global = globalThis;\n\n!function (JTML) {\n    JTML.DOMAIN = $(\"body:first\");\n    JTML.compileNow = true;\n    JTML.compiler = {};\n    JTML.compiler.$compiler = function (fun, name = fun.name, hide = true) {\n        JTML.compiler[name] = fun;\n        JTML.compiler[name].hide = hide;\n    };\n    JTML.compiler.$compiler(function set(tag) {\n        let tags = tag.children();\n        let tokenName = \"\", value = null;\n        let gotName = false, gotValue = false;\n        for (let i = 0; i < tags.length; i++) {\n            if (tags[i].localName == \"token\") {\n                tokenName = $(tags[i]).text();\n                gotName = true;\n                if (gotValue) {\n                    let tokens = tokenName.split(\".\");\n                    let tmp = global;\n                    for (let i = 0; i < tokens.length - 1; i++) {\n                        tmp = tmp[tokens[i]];\n                    }\n                    tmp[tokens[tokens.length - 1]] = value;\n                    gotValue = false;\n                    gotName = false;\n                }\n            }\n            if (tags[i].localName == \"value\") {\n                value = eval($(tags[i]).text());\n                gotValue = true;\n                if (gotName) {\n                    let tokens = tokenName.split(\".\");\n                    let tmp = global;\n                    for (let i = 0; i < tokens.length - 1; i++) {\n                        tmp = tmp[tokens[i]];\n                    }\n                    tmp[tokens[tokens.length - 1]] = value;\n                    gotValue = false;\n                    gotName = false;\n                }\n            }\n        }\n        return value;\n    }, \"set\");\n    JTML.compiler.$compiler(function show(tag) {\n        console.log(tag.text());\n        let v = eval(tag.text());\n        tag.text(v);\n        return v;\n    }, \"show\", false);\n\n    JTML.each = function (tag, cb) {\n        let tags = tag.children();\n        for (let i = 0; i < tags.length; i++) {\n            cb(tags[i]);\n            JTML.each($(tags[i]), cb);\n        }\n    };\n    JTML.compile = function (domain = JTML.DOMAIN) {\n        JTML.each(domain, function (tag) {\n            let compiler = JTML.compiler[tag.localName];\n            if (compiler) {// 存在这个jtml转义器\n                let tagJq = $(tag);\n                if (compiler.hide) tagJq.css(\"display\", \"none\");\n                compiler(tagJq);\n            }\n        });\n    };\n}(JTML);\n\n$(document).ready(function () {\n    if (JTML.compileNow) JTML.compile();\n});"]}